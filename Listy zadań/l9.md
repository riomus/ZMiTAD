Lista 9 T-Test
==========

Proszę się nie bać zadawania pytań ani pisania maili. 

*Na podstawie materiałów z poprzednich lat*

Testy t-Studenta służą do porównania ze sobą dwóch grup. Korzystamy z nich wtedy, gdy
mamy wyniki dla dwóch grup i chcemy porównać je ze sobą - tzn. stwierdzić, czy wyniki w
jednej grupie są większe bądź mniejsze niż w drugiej grupie.
Ogólnie wykorzystujemy test t kiedy dostępne dane pochodzące z eksperymentu (badania)
składają się z jednego parametru nominalnego (wyrażonego w skali nominalnej) oraz jednego
parametru ilościowego (pomiaru), i kiedy chcemy porównać wartości średnie (parametru
ilościowego). Parametr nominalny musi mieć jedynie dwie wartości, np. pleć (‘K’,’M’), leczenie
(‘leczony’,’nieleczony’), lek (‘lek’,’placebo’), itd.

Rodzaje testów
----------------

Istnieją trzy rodzaje testu t-Studenta:

1. 	test t dla prób niezależnych
	Ideą testu t-Studenta dla prób niezależnych jest porównanie ze sobą dwóch różnych
	grup obserwacji. Jak sama nazwa testu wskazuje, grupy (próby) muszą być wobec
	siebie niezależne, czyli wyniki pomiaru jednej grupy nie są zależne wobec pomiaru
	drugiej grupy.

2. 	test t dla prób zależnych
	Ideą testu t-Studenta dla prób zależnych jest porównanie ze sobą dwóch różnych grup
	obserwacji, które są wobec siebie zależne. Przykładowo, obserwacje tej samej grupy
	osób, obserwacje dwukrotne, gdzie wynik w drugim badaniu jest zależny od wyniku w
	pierwszym badaniu, ponieważ dotyczy tej samej osoby, obserwacji. W takiej sytuacji
	celem testu t-Studenta jest określenie wielkości zmian (tendencji) w danym pomiarze
	wśród badanych osob, obserwacji.

3. 	dla jednej próby
	Ideą testu dla jednej próby jest porównanie ze sobą średniej i odchylenia standardowego
	wyznaczonej dla jednej grupy osób badanych z pewną założoną odgórnie wartością. W
	tym kontekście porównanie jednej grupy stanowi wyjątek w rodzinie testów t-Studenta.
	W głównej mierze testy dla jednej próby stosuje się w celu zweryfikowania poprawności
	wyników badań względem znanej, często uznanej w teorii, z innych badań i analiz
	wartością.

W zależności od rodzaju badania stosujemy w analizach jeden z tych testów. 


Rozkład Studenta z stopniami swobody jest rozkładem zmiennej losowej t postaci:

![eq](https://latex.codecogs.com/gif.latex?t%3D%5Cfrac%7BU%7D%7B%5Csqrt%7BZ%7D%7D*%5Csqrt%7Bv%7D)

gdzie:

*	U jest zmienną losową zestandaryzowaną, 
*	Z jest zmienną losową o rozkładzie chi kwadrat o v stopniach swobody
*	U oraz Z są zmiennymi losowymi niezależnymi


Zmienna losowa t określona powyżej ma gęstość prawdopodobieństwa opisaną wzorem

![eq](https://latex.codecogs.com/gif.latex?f%28t%2Cv%29%3D%5Cfrac%7B%5CGamma%28%5Cfrac%7Bv&plus;1%7D%7B2%7D%29%7D%7B%5CGamma%28%5Cfrac%7Bv%7D%7B2%7D%29%5Csqrt%7Bv%5Cpi%7D%7D%281&plus;%5Cfrac%7Bt%5E2%7D%7Bv%7D%29%5E%7B-%5Cfrac%7Bv&plus;1%7D%7B2%7D%7D)

gdzie ![eq](https://latex.codecogs.com/gif.latex?%5CGamma%28x%29) to funkcja gamma

Dwa podstawowe twierdzenia związane z rozkłądem t-studenta

1. 	Niech zmienne losowe ![eq](https://latex.codecogs.com/gif.latex?X_1%2CX2%2C%5Cdots%2CX_n) mają jednakowy, normalny rozkład prawdopodobieństa (![eq](https://latex.codecogs.com/gif.latex?N%28m%2C%5Csigma%5E2%29)) oraz niech zmienna losowa t będzie określona wzorem

	![eq](https://latex.codecogs.com/gif.latex?t%3D%5Cfrac%7B%5Cbar%7BX%7D-m%7D%7Bs%7D*%5Csqrt%7Bn%7D)

	gdzie ![eq](https://latex.codecogs.com/gif.latex?%5Cbar%7BX%7D) jest empiryczną wartością średnią, s - empirycznym odchyleniem standardowym, n - licznością próby. 

	Wówczas zmienna t ma rozkłąd t-Studenta o v=n-1 stopniach swobody

2. 	Jeżeli dwie próby o liczebnościach ![eq](https://latex.codecogs.com/gif.latex?n_1) i ![eq](https://latex.codecogs.com/gif.latex?n_2), wartościach średnich ![eq](https://latex.codecogs.com/gif.latex?%5Cbar%7BX_1%7D) i ![eq](https://latex.codecogs.com/gif.latex?%5Cbar%7BX_2%7D) i wariancjach wyznaczonych z próby ![eq](https://latex.codecogs.com/gif.latex?s%5E2_1) i ![eq](https://latex.codecogs.com/gif.latex?s%5E2_2) zostały wylosowane z populacji mających taki sam rozkład normalny, to zmienna t określona wzorem:

![eq](https://latex.codecogs.com/gif.latex?t%3D%5Cfrac%7B%5Cbar%7BX_1%7D-%5Cbar%7BX_2%7D%7D%7B%5Csqrt%7Bn_1*s_1%5E2&plus;n_2*s_2%5E2%7D%7D*%5Csqrt%7B%5Cfrac%7Bn_1*n_2%7D%7Bn_1&plus;n_2%7D*%28n_1&plus;n_2-2%29%7D)

ma rozkład t studenta o ![eq](https://latex.codecogs.com/gif.latex?v%3Dn_1&plus;n_2-2) stopniach swobody

Test T dla prób niezależnych
------------------------------

Test t jest najbardziej powszechnie stosowaną metodą oceny różnic między średnimi w dwóch
grupach. Test ten został opracowany, żeby wychwycić różnice w wartościach średnich
pomiędzy badaniami pewnego atrybutu (jego wartości) względem dwóch różnych grup, lub
dwóch atrybutów dla pojedynczej grupy.
Teoretycznie test t może być stosowany także w przypadku bardzo małych prób (np. o liczności
10, zaś niektórzy badacze twierdzą, że nawet w mniej licznych są możliwe); jedynym
warunkiem jest normalność rozkładu zmiennych oraz brak istotnych różnic między wariancjami.
Jak zostało to wspomniane wcześniej założenie o normalności można sprawdzić przez analizę
rozkładu danych (np. histogramów, q-q plot, etc.) lub przy pomocy testu normalności.
Założenie o równości wariancji sprawdzamy za pomocą testu F lub też przy pomocy
mocniejszej opcji określonej jako test Levene’a.
Jeżeli warunki, o których mowa nie są spełnione, wówczas alternatywą pozostaje użycie
jednego z testów nieparametrycznych alternatywnych w stosunku do testu t.

### Założenia
Podajemy tutaj tylko najważniejsze założenia:

1. 	rozkład wyników zmiennej zależnej w każdej grupie jest zbliżony do rozkładu normalnego. W celu sprawdzenia, czy wyniki mają rozkład normalny można zastosować test K-S (Kołmogorowa-Smirnowa) bądź test Shapiro-Wilka

2. 	porównywane grupy mają podobną liczebność (ilość badanych osób). Aby dokładnie	sprawdzić, czy grupy są równoliczne (podobna liczbeność) przeprowadza się test chikwadrat zgodności. Jednakże badacze, w szczególności nauk społecznych przyjmują, że gdy jedna z grup nie przekracza liczebnością drugiej dwukrotnie, to można przyjąć, że grupy są równoliczne.

3. 	wariancje w porównywanych grupach są do siebie podobne. Aby sprawdzić te założenie stosuje się dodatkowy test, przykładowo test Levene'a. 

### Hipoteza

![eq](https://latex.codecogs.com/gif.latex?H_0%3A%20%5Cmu_1%20%3D%20%5Cmu_2%20%5C%5C%20H_1%3A%20%5Cmu_1%20%5Cneq%20%5Cmu_2%5C%20lub%5C%20H_1%3A%20%5Cmu_1%20%3C%20%5Cmu_2%5C%20lub%5C%20H_1%3A%20%5Cmu_1%20%3E%20%5Cmu_2)

Test T dla prób zależnych
--------------------------

W ogólności test ten można wykorzystać w celu weryfikacji czy wyniki danej grupy różnią się
pomiędzy warunkami w jakich zostały one zebrane. Można go na przykład użyć do sprawdzenia
różnicy w reakcji przeprowadzanej na grupie pacjentów poddanych działaniu jakiegoś leku w
stosunku do tej samej grupy osób przed otrzymaniem leku.

### Zmienność wewnątrzgrupowa

Siła relacji pomiędzy dwiema zmiennymi, mierzona na przykład różnicą pomiędzy średnimi w
dwóch grupach, zależy w dużej mierze od zmienności wartości wewnątrz grup. W zależności od
tego, jak duża jest ta zmienność w obydwu grupach, taka sama co do "wartości różnica" między
średnimi może wskazywać na silną lub słabą zależność pomiędzy zmienną zależną a
niezależną (grupującą).
Na przykład jeśli średnia LBC (liczba białych ciałek) wynosi 102 u mężczyzn i 104 u kobiet,
wówczas różnica "jedynie" 2 punkty musi zostać oceniona jako niezwykle istotna w przypadku,
gdyby u wszystkich mężczyzn wyniki zawierały się w granicach 101 do 103, zaś u wszystkich
kobiet w granicach 103 do 105. W takim wypadku moglibyśmy precyzyjnie przewidzieć wartość
LBC przy pomocy zmiennej Płeć. Jeśliby jednakże taka sama różnica równa 2 została uzyskana
w próbach o dużej zmienności (np. o zakresie zmienności 0 - 200), wówczas każdy skłonny
byłby taką różnicę ocenić jako nieistotną. Możemy zakończyć następującą konkluzją:
zmniejszenie zmienności wewnątrzgrupowej zwiększa czułość naszego testu.
Test t dla prób zależnych pozwala na wykorzystanie pewnego specyficznego typu układu
eksperymentalnego, w którym ważne źródło zmienności wewnątrzgrupowej (lub tzw. błędu) 
może zostać łatwo zidentyfikowane i wykluczone z analizy. W szczególności, jeśli dwie grupy
obserwacji (które mają zostać porównane) zostały oparte na tej samej grupie obiektów
zmierzonych dwukrotnie (np. przed i po zabiegu), to wówczas znaczna część zmienności
wewnątrzgrupowej w obydwu grupach wyników może zostać przypisana początkowej
indywidualnej różnicy pomiędzy obiektami. Zauważmy, że w pewnym sensie fakt ten jest
podobny do sytuacji, kiedy obydwie grupy są całkowicie niezależne i indywidualne różnice
również wnoszą wkład do składnika błędu. W tym ostatnim przypadku nie możemy jednak
zidentyfikować (lub, inaczej mówiąc," wyeliminować") wariancji pochodzącej od indywidualnych
różnic poszczególnych obiektów.
Jeśli jednak ta sama próba została zmierzona dwukrotnie, to wariancję tę łatwo jest
zidentyfikować ("wyeliminować"). Można w szczególności, zamiast analizować oddzielnie każdy
z pomiarów, brać do analizy różnice pomiędzy wynikami,(przed i po) dla każdego z obiektów
pomiarowych. Przez procedurę odejmowania wyniku przed zabiegiem od wyniku po zabiegu i
analizowaniu "czystych różnic" dokonujemy wyeliminowania tej części wariancji w naszym
zbiorze danych, która pochodzi od różnic w wartościach bezwzględnych poszczególnych
obiektów pomiarowych. Dokładnie tak przebiega procedura w opcji test t dla prób zależnych i w
porównaniu z testem t dla prób niezależnych daje ona zawsze "lepsze" wyniki (w tym sensie, że
jest bardziej czuła).
Założenia teoretyczne występujące w przypadku testu testu t dla prób niezależnych mają
również zastosowanie w teście dla prób zależnych; to znaczy różnice pomiędzy parami
pomiarów powinny mieć rozkład normalny. Jeśli założenie to jest zdecydowanie niespełnione,
wówczas należy zastosować jeden z alternatywnych testów nieparametrycznych.

### Hipoteza

![eq](https://latex.codecogs.com/gif.latex?H_0%3A%20%5Cmu_1-%20%5Cmu_2%20%3D0%20%5C%5C%20H_1%3A%20%5Cmu_1%20-%20%5Cmu_2%5Cneq0%5C%20lub%5C%20H_1%3A%20%5Cmu_1-%5Cmu_2%20%3C0%20%5C%20lub%5C%20H_1%3A%20%5Cmu_1-%5Cmu_2%20%3E0)

Test T dla jednej próby
--------------------------

### Założenia

Podajemy tutaj tylko najważniejsze założenia:
1. 	rozkład wyników zmiennej zależnej jest zbliżony do rozkładu normalnego. 

### Hipoteza

![eq](https://latex.codecogs.com/gif.latex?H_0%3A%20%5Cmu_1%3D%5Cmu%20%5C%5C%20H_1%3A%20%5Cmu_1%20%5Cneq%20%5Cmu%20%5C%20lub%5C%20H_1%3A%20%5Cmu_1%3C%5Cmu%20%5C%20lub%5C%20H_1%3A%20%5Cmu_1%3E%5Cmu)


Mann-Whitney U test
---------------------

[plik do pobrania](https://www.mathworks.com/matlabcentral/fileexchange/25830-mwwtest-x1-x2-)

Test U Manna-Whitneya jest jedną z najpopularniejszych alternatyw dla testu t-Studenta dla
prób niezależnych. Jeżeli dane nie spełniają założeń dla zastosowania testu t-Studenta, a
wobec czego, nie możemy go zastosować, warto skorzystać z testu U Manna-Whitneya, gdy
chcemy porównać ze sobą dwie niezależne wobec siebie grupy. Podstawową zaletą tego testu
są niewielkie wymogi, założenia do zastosowania testu U Manna-Whitneya.
Zmienna zależna musi być mierzona na skali co najmniej porządkowej (może być również
mierzona na skali ilościowej). Jest to podstawowy warunek dla zastosowania tego testu. Co
ciekawe, z tego testu możemy skorzystać również, gdy zmienna jest mierzona na skali
dychotomicznej (czyli 0-1), dlatego, że jest to przypadek zmiennej nominalnej, która jest
zarazem zmienną porządkową. Zastosowanie testu U Manna-whitneya nie wymaga
równoliczności grup, rozkładu normalnego czy też homogenicznych wariancji. To sprawia, że
może być on szeroko stosowany.
Test U Manna-Whitneya polega na rangowaniu wyników zmiennej zależnej (od najmniejszej do
największej) w badanych grupach, a następnie grupy są ze sobą porównywane.
W statystyce, test U Manna–Whitneya (zwany również testem Manna-Whitneya-Wilcoxona lub
czasem testem sumy rang Wilcoxona dla dwu próbek, albo po prostu testem Wilcoxona dla
dwóch próbek) jest nieparametrycznym testem do sprawdzenia czy wartości próbek pobranych
z dwóch niezależnych populacji są jednakowo duże. Jest jednym z najbardziej popularnych
nieparametrycznych testów znamienności. Zaproponowany pierwotnie jako test przesunięcia
dla dwóch równolicznych próbek przez Franka Wilcoxona w 1945, uogólniony następnie przez
H. B. Manna i D. R. Whitneya (1947) dla przypadku różnolicznych próbek oraz do testowania
równości stochastycznej.

### Założenia

1. 	wszystkie obserwacje, dla obydwu grup, są niezależne statystycznie,
2. 	zmienne X i Y mierzone są na skali porządkowej, a więc dla dowolnej pary obserwacji, można określić ich uporządkowanie: stwierdzić ich równość lub wskazać na większą spośród nich.
3. 	testowaną hipotezą zerową jest symetria względem prawdopodobieństwa większej wartości jednej ze zmiennych, a więc hipoteza zerowa zakłada jednakowe prawdopodobieństwo X > Y i Y > X: P(X > Y)=P(Y > X).
4. 	hipotezą alternatywną jest asymetria względem prawdopodobieństwa większej wartości jednej ze zmiennych, a więc w wersji dwustronnej testu, że prawdopodobieństwo X > Y jest różne od prawdopodobieństwa Y > X (w wersji jednostronnej, hipotezą alternatywną jest P(X > Y) > P(Y > X) lub P(X > Y) < P(Y > X)).

Test Manna-Whitneya w ogólnej wersji, sformułowanej powyżej, ma słabe założenia i może być
stosowany w bardzo szerokim zakresie. W literaturze jednak często zdarza się, że hipotezy
zerowa i alternatywna formułowane są w sposób mniej ogólny, stosowalność testu MannaWhitneya
do testowania tych hipotez jest wówczas ograniczona. Tak więc czasem zakłada się,
że wg hipotezy zerowej obydwie zmienne X i Y mają identyczny rozkład, a wg hipotezy
alternatywnej ich rozkłady są jednakowe z wyjątkiem przesunięcia o stałą δ (tzn. F1(x) = F2(x +
δ)). Taka interpretacja testu Manna-Whitneya nazywa się czasem testowaniem przesunięcia. W
praktyce zwykle zmienne różnić się mogą nie tylko pod względem przesunięcia ale i innych
parametrów np. wariancji, wówczas stosowalność tak interpretowanego testu Manna-Whitneya
jest wątpliwa, a test może mieć małą moc dla odrzucenia hipotezy zerowej. Np. test nie jest w
stanie odrzucić hipotezy zerowej o identyczności rozkładów gdy X i Y są zmiennymi normalnymi
o tej samej średniej ale różnych wariancjach.
Innym dodatkowym założeniem dodawanym czasem dla wygody obliczeniowej jest brak
obserwacji związanych: tzn. zerowe prawdopodobieństwo otrzymania dwu obserwacji o
jednakowej wartości. Jednak założenie braku obserwacji związanych nie jest konieczne, test
Manna-Whitneya stosować można w obecności obserwacji związanych używając poprawek
obliczeniowych na obserwacje związane lub przeprowadzając obliczenia przy pomocy testu
permutacji.
Hipotezy analitycznie w ogólności najłatwiej wyrazić za pomocą tzw. stochastycznej równości
(bądź nierówności) dystrybuant. Nie będziemy jej tutaj dodatkowo definiować i pozostaniemy
przy oryginalnej reprezentacji.

### Hipoteza

![eq](https://latex.codecogs.com/gif.latex?H_0%3A%20P%28X%3EY%29%3DP%28X%3CY%29%20%5C%5C%20H_1%3A%20P%28X%3EY%29%20%5Cneq%20P%28X%3CY%29%20%5C%20lub%5C%5C%20H_1%3A%20P%28X%3EY%29%3CP%28X%3CY%29%20%5C%20lub%5C%5C%20H_1%3AP%28X%3EY%29%3EP%28X%3CY%29)

Matlab
--------

1. [ttest](https://www.mathworks.com/help/stats/ttest.html)
2. [ttest2](https://www.mathworks.com/help/stats/ttest2.html)

Zadania (  **Środowisko:** matlab)
----------

1. Zapoznaj się z parametrami funkcji do wykonywania t-testu w matlabie (manual), jakie wartości mogą przyjmować co oznaczają

2. Wygeneruj dwie próbki z rozkładu normalnego o wybranych parametrach (równe odchylenie jednak nieznacznie różniące się średnie), przeprowadź t-test dla prób, poeksperymentuj z różnymi wartościami średnich jak i możliwymi parametrami funkcji

3. Ludzie nerwowi mają więcej energii niż osoby spokojne i stonowane. Zastanówmy się zatem czy osoby nerwowe mają tendencję do widocznie silniejszej gestykulacji. W tym celu udało nam się zapytać 5 osób, które wskazują na wszelkie oznaki nerwowości, i zarejstrowaliśmy średnią 6 ilość gestów jakie wykonują na minutę podczas swobodnej konwersacji. Następnie analogiczne obserwacje poczyniliśmy dla osób spokojnych. W ten sposób otrzymaliśmy następujące dane:

	```matlab
	nerw=[3, 3, 4, 5, 5]
	spok=[4, 6, 7, 9, 9]
	```

	Określ hipotezę jaką chcemy zweryfikować w naszym badaniu oraz określ hipotezę zerową dla testu ? Czy możemy zastosować test t, jeżeli tak to jaki jedno- czy dwustronny ? Jaki stopień swobody powinniśmy zastosować ? Przeprowadź test przy alpha = 0.05 i alpha=0.1. Zinterpretuj pełny wynik analizy.

4. 	Sprawdźmy hipotezę, iż osoby poniżej 30 są bardziej dowcipni niż osoby po 30. Sprawdźmy tę hipotozę na bazie wyników ankiety przeprowadzonej na 4 losowo wybranych osobach przed 30 i 4 po 30. Dla każdej osoby wyznaczamy współczynnik ich ‘rozbawienia’ na skali Likerta 1-10.

	```matlab
	mniej30 =[6, 7, 10, 9]
	po30 = [5, 6, 2, 3]
	```

	Określ hipotezę jaką chcemy zweryfikować w naszym badaniu oraz określ hipotezę zerową dla testu ? Czy możemy zastosować test t, jeżeli tak to jaki jedno- czy dwustronny ? Jaki stopień swobody powinniśmy zastosować ? Przeprowadź test przy alpha = 0.05. Zinterpretuj pełny wynik analizy.

5. Wykonaj zadanie 4 zakładając zależność zmiennych

6. 	Przeanalizujmy, czy średni wzrost studentów wynosi 169.051:
	```matlab
	data=[75.26,177.8,167.64,160.02,172.72,177.8,175.26,170.18,157.48,160.02,193.04,149.86,157.48,157.48,190.5,157.48,182.88,160.02]
	```
	Wygeneruj próbkę danych o takiej samej liczności, dla której spełniony by był test

6. 	Przeanalizujmy, czy średni wzrost studentów wynosi 164.1475:
	```matlab
	data=[172.72,157.48,170.18,172.72,175.26,170.18,154.94,149.86,157.48,154.94,175.26,167.64,157.48,157.48,154.94,177.8]
	```
	Wygeneruj próbkę danych o takiej samej liczności, dla której spełniony by był test

7. Zastanówmy się ponownie czy osoby nerwowe mają tendencję do widocznie silniejszej gestykulacji. Wykorzystajmy wcześniejsze dane o ludziach spokojnych i nerwowych. Określ hipotezę jaką chcemy zweryfikować w naszym badaniu oraz określ hipotezę zerową dla testu ? Czy możemy zastosować test U? Przeprowadź test przy alpha = 0.05. Zinterpretuj pełny wynik analizy.

8. 	W celu analizy wzrostu studentów różnych grup zajęciowych pozyskaliśmy następujące próbki:

	```matlab
	data13=[175.26,177.8,167.64,160.02,172.72,177.8,175.26,170.18,157.48,160.02,193.04,149.86,157.48,157.48,190.5,157.48,182.88,160.02]
	data17=[172.72,157.48,170.18,172.72,175.26,170.18,154.94,149.86,157.48,154.94,175.26,167.64,157.48,157.48,154.94,177.8]
	```

	Zbadaj z pomocą testu U, czy wzrost studentów z jednej grupy jest równie duży jak wzrost studentów drugiej grupy. Sformułuj hipotezy i przeprowadź test przy alpha = 0.05. Zinterpretuj pełny wynik analizy